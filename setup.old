#!/bin/bash
set -e

# ====== STYLE ======
NL="\n"; NL2="${NL}${NL}"
ESC="\033"

NORM="${ESC}[0m"
BOLD="${ESC}[1m"
RVON="${ESC}[7m"
RVOFF="${ESC}[27m"

COL_DFLT="${ESC}[39m"
COL_LGRN="${ESC}[92m"
COL_LMAG="${ESC}[95m"
COL_LCYN="${ESC}[96m"

function _echo {
    echo -e "$1";
}

function _msg {
    _echo "${BOLD}${COL_LCYN}==>${NORM} ${COL_LGRN}$1${NORM}"
}

function _ok {
    _echo "${COL_LGRN}✔ $1${NORM}"
}

function _title {
    _echo "${RVON}${BOLD}${COL_LMAG} $1 ${NORM}${RVOFF}"
}

# ====== START ======

_title "Installazione JDK e JavaFX"
mkdir -p ~/.local/opt
tar -xzf archives/java.tar.gz -C ~/.local/opt/ && _ok "Java installato in ~/.local/opt/java"

_title "Installazione IntelliJ IDEA"
sudo tar -xzf archives/ideaIU-2024.3.3.tar.gz -C /opt/ && _ok "IntelliJ estratto in /opt"

_title "Installazione HelloFX"
mkdir -p ~/IdeaProjects
tar -xzf archives/HelloFX.tar.gz -C ~/IdeaProjects/ && _ok "HelloFX installato in ~/IdeaProjects/"

_title "Configurazione IntelliJ"
CONFIG_DIR=~/.config/JetBrains/IntelliJIdea2024.3
mkdir -p $CONFIG_DIR/options
cp config/path.macros.xml $CONFIG_DIR/options/
cp config/applicationLibraries.xml $CONFIG_DIR/options/
_ok "Configurazioni copiate in $CONFIG_DIR/options"

_title "Installazione template IntelliJ..."
TEMPLATES_DIR=$CONFIG_DIR/projectTemplates
mkdir -p $TEMPLATES_DIR
cp config/templates/Programmazione-2.zip $TEMPLATES_DIR/
_ok "Template 'Programmazione-2' copiato in IntelliJ"

_title "Installazione completata"
_echo "${NL}Puoi ora avviare IntelliJ IDEA e creare un nuovo progetto utilizzando il template 'Programmazione-2'."
_echo "Il progetto HelloFX è disponibile in ~/IdeaProjects/HelloFX."
_echo "${NL}Buon lavoro!"
_echo "Per avviare IntelliJ IDEA, esegui: '/opt/idea-IU-*/bin/idea.sh'"
_echo "(poi potrai creare una desktop entry dall'IDE: Ingranaggio in basso a destra -> 'Create Desktop Entry...')."
